<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Yo-kai Watch Color Calculator</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  input, select, textarea, button { margin: 5px 0; font-size: 1rem; }
  #output { 
    margin-top: 10px; 
    font-weight: bold; 
    font-size: 1.2rem; 
    display: flex; 
    align-items: center;
    gap: 10px;
  }
  #previewBox {
    width: 25px;
    height: 25px;
    border-radius: 4px;
    border: 1px solid #888;
  }
  textarea { width: 300px; height: 40px; }
</style>
</head>
<body>

<h2>Yo-kai Watch Color Calculator</h2>

<p>Yo-kai Watch supports these formats:</p>
<ul>
  <li><code>&lt;C0&gt;</code> to <code>&lt;C30&gt;</code> (fixed color codes)</li>
  <li><code>&lt;C#RRGGBB&gt;</code> (RGB888)</li>
  <li><code>&lt;C"RGB776&gt;</code> (7-bit Red, 7-bit Green, 6-bit Blue)</li>
</ul>

<label for="colorPicker">Pick a color:</label>
<input type="color" id="colorPicker" value="#aabbcc">

<div>
<label for="format">Output format:</label>
<select id="format">
  <option value="RGB776">&lt;C"RGB776&gt;</option>
  <option value="RGB888">&lt;C#RGB888&gt;</option>
</select>
</div>

<div>
<label for="inputText">Or input &lt;C"RGB776&gt;:</label>
<textarea id="inputText" placeholder='e.g., <C"4EEBF>'></textarea>
</div>

<button id="encodeBtn">Convert / Encode</button>
<button id="copyBtn">Copy</button>

<div id="output">
  <span id="outputText"></span>
  <div id="previewBox"></div>
</div>

<script>
function rgb888ToRgb776(r, g, b) {
    let r7 = Math.round(r / 255 * 127);
    let g7 = Math.round(g / 255 * 127);
    let b6 = Math.round(b / 255 * 63);
    let value = (r7 << 13) | (g7 << 6) | b6;
    return value.toString(16).toUpperCase().padStart(5, '0'); // 5 hex digits
}

function rgb776ToRgb888(hex776) {
    let value = parseInt(hex776, 16);
    let r7 = (value >> 13) & 0x7F;
    let g7 = (value >> 6) & 0x7F;
    let b6 = value & 0x3F;
    let r = Math.round(r7 * 255 / 127);
    let g = Math.round(g7 * 255 / 127);
    let b = Math.round(b6 * 255 / 63);
    return { r, g, b };
}

function rgbToHex(r, g, b) {
    return ((1<<24) + (r<<16) + (g<<8) + b).toString(16).slice(1).toUpperCase();
}

function updateOutput() {
    const colorPicker = document.getElementById('colorPicker').value;
    const inputText = document.getElementById('inputText').value.trim();
    const format = document.getElementById('format').value;

    let output = '';

    if (/^<C"[0-9A-Fa-f]{5}>$/.test(inputText)) {
        // Decode RGB776 input
        let hex776 = inputText.slice(3, -1);
        let rgb = rgb776ToRgb888(hex776);
        document.getElementById('colorPicker').value = `#${rgbToHex(rgb.r, rgb.g, rgb.b)}`;
        output = `<C#${rgbToHex(rgb.r, rgb.g, rgb.b)}>`;
    } else {
        // Encode from color picker
        const r = parseInt(colorPicker.substr(1, 2), 16);
        const g = parseInt(colorPicker.substr(3, 2), 16);
        const b = parseInt(colorPicker.substr(5, 2), 16);

        if (format === 'RGB776') {
            output = `<C"${rgb888ToRgb776(r, g, b)}>`;
        } else {
            output = `<C#${colorPicker.substr(1).toUpperCase()}>`;
        }
    }

    document.getElementById('outputText').textContent = output;
    document.getElementById('previewBox').style.backgroundColor = colorPicker;
}

document.getElementById('encodeBtn').addEventListener('click', updateOutput);

// Live preview when picking a color
document.getElementById('colorPicker').addEventListener('input', updateOutput);

// Copy button
document.getElementById('copyBtn').addEventListener('click', () => {
    const text = document.getElementById('outputText').textContent;
    if (text) navigator.clipboard.writeText(text);
});
</script>

</body>
</html>
